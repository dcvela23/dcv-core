var through2 = require('through2');
var vfs = require('vinyl-fs');
var utils = require('./lib/utils');
var stream = require('stream');

var metadata = [];
var locales = vfs.src('test/fixtures/locales/*.{yml,json}')
  .on('end', function () { console.log('end', arguments) })
  .on('finish', function () { console.log('finish', arguments) });

locales
  .pipe(through2.obj(function (f,enc,cb) {
    console.log(f,enc,cb);
    metadata.push(utils.parseLocaleName(utils.extractFilename(f.path).simplename, false))
    cb(null, f.clone());
  }), { end: false });

setTimeout(function () {
  console.log('another pipe');
  locales
    .pipe(through2.obj(function (f,enc,cb) {
      console.log(f,enc,cb);
      f = f.clone();
      cb(null, f);
    }))
}, 4000);
